<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>PetVet | Client Portal</title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link href="/css/templatemo_style.css" type="text/css" rel="stylesheet" />


	<!--
Singular Template
http://www.templatemo.com/preview/templatemo_359_singular
-->
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="/js/jquery.scrollTo-min.js"></script>
	<script type="text/javascript" src="/js/jquery.localscroll-min.js"></script>
	<script type="text/javascript" src="/js/init.js"></script>

	<script type="text/javascript" src="/js/script.js"></script>
	<link rel="stylesheet" href="/css/slimbox2.css" type="text/css" media="screen" />
	<script type="text/JavaScript" src="/js/slimbox2.js"></script>
	<!-- Timestamp: 1236819900 -->
</head>

<body>
	<div id="templatemo_header_wrapper">
		<div id="templatemo_header">
			<br />
			<br />
			<p id="intro_text">CLIENT PORTAL</p>
			<br />
			<br />
			<br />
			<br />
			<% if @current_user %>
			<%if @current_user.user_details%>
			<h1> Welcome, <%= @current_user.user_details.full_name.split(' ').first.capitalize %>! </h1>
			<%end%>
			<% else %>
			<h1> &nbsp; </h1>
			<%end%>
	</div>

	<div id="templatemo_main_wrapper">
		<div id="templatemo_main">
			<div id="content">

				<% if @current_user %>

      	<div id="home" class="section">
        	<ul id="templatemo_menu">
	          <li><a href="#about" class="about"><span>Profile</span></a></li>
	          <li><a href="#book" class="services"><span>Appointments</span></a></li>
	          <li><a href="#medicines" class="portfolio"><span>Medicines</span></a></li>
	          <li><a href="#testimonial" class="testimonial"><span>Testimonial</span></a></li>
	          <li class="no_margin_right"><a href="#chat" class="contact"><span>Contact</span></a></li>
          </ul>
        </div>

  			<%if @current_user.user_details%>

        <div class="section" id="about">
					<div id='main'>
			  	<div class="half left">
						<div class="show-container entry" style="width: 50%; height: 360px; z-index: 1;">
							<p class="p_prof">Client's <span>profile:</span></p>
							<div class='non-form-container'>
				        <p class="detail_title">Full name:</p>
				        <p><%=@current_user.user_details.full_name%></p>
				        <p class="detail_title">Date of birth:</p>
				        <p><%=@current_user.user_details.dob%></p>
				        <p class="detail_title">Gender:</p>
				        <p><%=@current_user.user_details.gender%></p>
				        <p class="detail_title">Current address:</p>
				        <p><%=@current_user.user_details.address%></p>
				        <p class="detail_title">Phone number:</p>
				        <p><%=@current_user.user_details.phone_number%></p>
							</div>
						</div>
					</div>

    			<div class="half right">
						<div class="show-container entry" style=" z-index: 1; overflow: hidden; width: 70%; height: 360px; margin-right: 60px; position: relative; left: -110px;">
							<p class="p_prof">Pet's <span>profile:</span></p>

							<div class="scrollbar style-1" style="overflow-x: hidden; overflow-y: auto; height: 340px; width: 100%; position:relative; top: -40px; left: 0px;">
								<div id='pet-card' class="force-overflow" >
				 					<% @current_user.pets.each_with_index do |p,i| %>
									<div class='imgcontainer' style=' height: 80px'>
										<% path = (p.img != nil) ? p.img : '/img/default.jpg' %>
										<button id='picBtn<%=i%>' onclick="upfrmOn(<%=i%>);" style="border-radius: 100%; background-color: transparent; width:100px; height: 100px; position: relative; top: -30px; left: 0px;  z-index: 1;" >
										<img src=<%=path%> alt='Avatar' title='Upload photo' class='avatar' >
										</button>
										<div id='fileUp<%=i%>'  style='background-color: rgba(248, 248, 248, 0.5); position: relative; top: -120px; display: none; z-index: 10;' >
										<form action="/users/<%=@current_user.id%>/upload" method="post" enctype="multipart/form-data" style='background-color:rgba(245, 245, 245, 0.3); width: 100%; '>
											<input type="file" name="file">
											<input type="submit" value="Upload image">
											<input type="hidden" name="petid" value=<%=p.id%>>
										</form>
										</div>
									</div>
									<hr />

							  	<form action='/users/<%=@current_user.id%>/form' method='post' id='petInf<%=i%>' style='width: 220px; height: 200px;'>
							    	<fieldset id='fld<%=i%>' disabled  style='width: 197px; height: 185px;' >
		                  <label class='pet_name' for='pet_name'><b>Name:</b></label>
		                  <input class='pet_name' type='text' value=<%=p.name%> name='pet_name' required>
											<br />
		                  <label class='pet_age' for='pet_age'><b>Age:</b></label>
		                  <input class='pet_age' type='text' value=<%=p.age%> name='pet_age' required>
											<br />
											<hr />
		                  <label class='gender' for='gender'><b>Gender:</b></label>
		                  <select name='pet_gender' id='gender' required>
													<% bool_one = (p.gender == 'Male') ? 'selected' : '' %>
													<% bool_two = (p.gender == 'Female') ? 'selected' : '' %>
		                      <option value='Male' <%= bool_one %>>Male</option>
		                      <option value='Female' <%= bool_two %>>Female</option>
		                  </select>
											<br />
		                  <label class='address' for='address'><b>Breed:</b></label>
		                  <input type='text' class='address' value=<%=p.breed%> name='breed' required>
		                  <input type="hidden" name="cmd<%=i%>" value='update<%=i%>'>
		                  <input type="hidden" name="petid<%=i%>" value=<%=p.id%>>
		                  <button id='sndBtn<%=i%>' type='submit' style='visibility: hidden; position:relative; top: -2px; left: 105px; width: 57px;'>Submit</button>
						     		</fieldset>
			      			</form>
									<% if @current_user.pets.size > 1 %>
									<form action='/users/<%=@current_user.id%>/delpet' method='post' style="background: transparent !important; width: 1px; height: 1px; position: relative; top: -45px; left: 187px; " >
										<input type="hidden" name="petid" value=<%=p.id%>>
									<button type="submit" id='delBtn<%=i%>' style=" border-radius: 100%; background-color: Transparent; width:30px; height: 30px; position: relative; top: 0px; left: 0px;" >

										<img src="/img/x.png" width="20" height="20" title="Delete" alt="Delete" style="border-radius: 100%; position: relative; top: 0px; left: -3px;" >
									</button>
									</form>
									<%end%>
							    <button type="button" id='editBtn<%=i%>' name="button" onclick='frmOn(<%=i%>);' style='position:relative; top: -47px; left: 20px; width: 55px;' >Edit</button>

									<%end%>
									<hr />
								</div>
							</div>
						</div>   <!-- End of show-container -->
					</div> <!-- End of half right -->
					</div>
					<div>
                <a href="#home" class="home_btn">home</a>
								<% idx = @current_user.pets.size %>
								<button id='addPetBtn' onclick="petfrmOn(<%=idx%>);" style="float: right; border-radius: 100%; background-color: transparent; width:40px; height: 40px; position: relative; top: -28px; left: 100px;  z-index: 1;" >
									<img src="/img/menu.png" width="30" height="30" title="Add another pet" alt="Add New Pet" style="border-radius: 100%; position: relative; top: -2px; left: -3px;">
								</button>
                <a href="#home" class="page_nav_btn previous">Previous</a>
                <a href="#book" class="page_nav_btn next">Next</a>
						</div>

						<div id='addPet' align="center" style="visibility: hidden; width: 100%; height: 100%; background-color: #ccc; z-index: 10; ">
							<form class="entry" action='/users/<%=@current_user.id%>/form' method='post' id='details' style='position: relative; top: 100px; height: 300px; left: 0px; border-radius: 5px;'>
								<div id='frm' style='height: 440px; text-align: center;  position: relative; top: -80px; left: 0px;'>

									<%= pet_info_form %>
									<div id='btnDiv' style="text-align: center;  position: relative; top: -450px; left: 60px; ">
									<button type='submit'>Add</button>
									</div>
								</div>
								<input type="hidden" name="cmd" value='add_pet'>
							</form>
							<button id='cancBtn' onclick="petfrmOff();" style="position: relative; top: -89px; left: -50px; z-index: 10; ">Cancel</button>
						</div>

						<% else %>
						<div align="center">
							<form class="entry" action='/users/<%=@current_user.id%>/form' method='post' id='details'>
								<div id='frm' style='height: 440px; text-align: center;'>
									<%= add_user_detail_form %>
									<%= pet_info_form %>
									<button id='prvBtn'>Previous</button>

									<button type='submit'>Submit</button>
								</div>
							</form>
						</div>

						<%end%>



				</div> <!-- End of about  -->






            <div class="section" id="book">
                <div class="half left">
									<%if !@current_user.appointments.first %>
									<div align='center'>
									<section id="log_in_form" style="height: 710px;">

							        <form class="entry" action='/users/<%=@current_user.id%>/home' method='post' id='appointment'>
							        <p class="p_prof">Appointment <span>form:</span></p>
							            <div class='imgcontainer'>
							                <img src='/img/patient.svg' alt='Avatar' class='avatar'>
							            </div>

							            <div class='container'>
							                <label for='doctor'><b>Select doctor:</b></label>
							                <select name='doctor' form='appointment' id='doctor'>
							                    <option value="default" selected>Select doctor</option>
							                    <% Employee.all.each do |x| %>                             <!-- REFACTOR to @employee.all.each -->
							                    <option value='<%=x.id%>'><%=x.name%></option>
							                    <%end%>
							                </select>

							                <label for='doctor'><b>Select doctor:</b></label>
							                <select name='pet_name' form='appointment' id='doctor'>
							                    <option value="default" selected>Select your pet</option>
							                    <% @current_user.pets.all.each do |x| %>                             <!-- REFACTOR to @employee.all.each -->
							                    <option value='<%=x.name%>'><%=x.name%></option>
							                    <%end%>
							                </select>

							                <label for='doctor'><b>Select reason:</b></label>
							                <select name='reason' form='appointment' id='doctor'>
							                    <option value="default" selected>Select reason</option>
							                    <option value='consultation'>Consultation</option>
							                    <option value="surgery">Surgery</option>
							                    <option value='follow up'>Follow up</option>
							                    <option value='Lab work'>Lab work</option>
							                </select>

							                <label class='date' for='date'><b>Appointment's date:</b></label>
															<select name='date' form='appointment' id='doctor'>

															<option value='04/02/2020 | 03:30pm'>04/02/2020 | 03:30pm</option>
															<option value="04/07/2020 | 10:30am">04/07/2020 | 10:30am</option>
															<option value='04/07/2020 | 01:00pm'>04/07/2020 | 01:00pm</option>
															<option value='04/10/2020 | 02:30pm'>04/10/2020 | 02:30pm</option>
													</select>


							                <label for='address'><b>Enter your concerns:</b></label>
							                <textarea  placeholder='Enter a detailed description' name='symptoms' required></textarea>

							                <label for='full-name'><b>Enter full name to confirm!</b></label>
							                <input type='text' name='full_name' id="full-name" placeholder="Enter your full name" required>

							                <button type='submit'>Schedule</button>
							            </div>
							        </form>
							    </section>
									</div>

									<%end%>

                </div>
                <div class="half right">

											<%if @current_user.appointments.first%>
<div class="show-container style-1" style="overflow-x: hidden; overflow-y: auto; width: 70%; height: 380px; margin-right: 60px; position: relative; left: -110px;">
													<section id="upcoming" class="entry1">
															<p class="p_prof">Upcoming <span>appointment:</span></p>
															<div class='imgcontainer'>
																	<img src='/img/doc-apt.webp' alt='Avatar' class='avatar'>
															</div>
							<div class="style-1" style="overflow-y: auto; max-height: 400px;">
															<% @current_user.appointments.each do |a| %>
															<hr />
																	<p class="detail_title">Doctor's name:</p>
																	<p><%=@doctor.name%></p>

																	<p class="detail_title">Appointment date:</p>
																	<p><%=a.apt_date%></p>

																	<p class="detail_title">Your concerns:</p>
																	<p><%=a.symptoms%></p>

																	<p class="detail_title">Your appointment's reason:</p>
																	<p><%=a.reason%></p>

																	<p class="detail_title">Your appointment's status:</p>
																	<p><%=a.status%></p>

															 <%end%>
								</div>
													</section>
								</div>
								<%end%>

                </div>


                <a href="#home" class="home_btn">home</a>
                <a href="#about" class="page_nav_btn previous">Previous</a>
                <a href="#medicines" class="page_nav_btn next">Next</a>
            </div>








            <div class="section" id="medicines">
							<div align='center'>
							<div class="show-container style-1" style="text-align: center; overflow-x: hidden; overflow-y: auto; width: 55%; height: 360px; ">
							<section id="rx" class="entry2">
	                <p class="p_prof">Current <span>medications:</span></p>
	                <div class='imgcontainer'>
	                    <img src='/img/medicine.svg' alt='Avatar' class='avatar'>
	                </div>
<div align='center'>
<div class="style-1" style="overflow-y: auto; max-height: 340px; width: 60%; text-align: left;">
	                <% if @medicine %>
	                    <% @medicine.each do |x| %>
											<hr />
	                    <p>Rx: <span><%= x.rx_name %></span> </p>
										  <p>	Prescription dosage: <span><%= x.pill_count %></span> x <span><%= x.pill_size %> mg </span></p>
											<p>	Prescribed for: <%= Pet.find_by(id: x.pet_id).name %>. </p>
	                    <p class="by_doctor"> By: Dr. <%= Employee.find_by(id: x.employee_id).name %> . </p>
											<hr />
	                    <% end %>
	                <% end %>
</div>
</div>

	            </section>
				</div>
		</div>
                <a href="#home" class="home_btn">home</a>
                <a href="#book" class="page_nav_btn previous">Previous</a>
                <a href="#testimonial" class="page_nav_btn next">Next</a>

</div>






            <div class="section" id="testimonial">

							<div align='center'>
								<% @review = Review.all.find_by(user_id: @current_user.id) %>
								<% if @review %>
								 <div id="review" class="style-1">
										<h4><%= @review.title%><img id="star_<%= @review.rating %>" src="/img/transp.png" width="1" height="1" style="float: right;"></h4>
										<hr />
										<p><%= @review.content%></p>
										<hr />
									<p style="float: right;">	Posted: <span><%= @review.date%></span> | By: <%= "#{@current_user.user_details.full_name.split(' ').first.capitalize}."  %> </p>
									</div>
								<% else %>
								<h2>Leave a review</h2>
			        <form action="/review/new" method="post" id="review">
			            <div class="imgcontainer">
			                <img src="/img/reviews.png" alt="Avatar" class="avatar">
			            </div>

			            <div class="container">

			                    <label class="title" for="title"><b>Review Title:</b></label>
													<br />
			                    <input class="title" type="text"  name="title"  placeholder="Enter a title" required>
													<br />
			                    <label class="content" for="content"><b>Tell us your experience:</b></label>
													<br />
			                    <textarea placeholder="Share your experience" name="content"></textarea>
													<br />
			                    <label class="rating" for="rating"><b>Rate us:</b></label>
			                    <select name="rating" for="review">
			                        <option value="one">1</option>
			                        <option value="two">2</option>
			                        <option value="three">3</option>
			                        <option value="four">4</option>
			                        <option value="five">5</option>
			                    </select>
													<br />
			                    <label class="password" for="password"><b>Enter your current password:</b></label>
													<br />
			                    <input class="password" type="password" name="password" required>
													<br />
			                    <button type="submit">Confirm</button>
			            </div>
			        </form>

							<% end %>
							</div>

                <a href="#home" class="home_btn">home</a>
                <a href="#medicines" class="page_nav_btn previous">Previous</a>
                <a href="#chat" class="page_nav_btn next">Next</a>

</div>






            <div class="section" id="chat">
                <h1>Contact Information</h1>
                <div class="half right">
									<div align="center">
									            <form class="entry" action='/users/<%=@current_user.id%>/chat' method='post' id='chat' onsubmit="return fetchdata();">
									                <input type="text" id="msg" name="txtbox" maxlength="50" size="60" placeholder="Type your message here..." style="position: relative; left: -115px; border: 5px solid #ccc;">
									                <button type="submit" id="sendbtn" style="position: relative; top: -35px; left: 188px; width: 50px;">Send</button>
									            </form>

									            <div id="msgbox" class="style-1">
															<% if @current_user.messages %>
									              <% @current_user.messages.split("~").each do |m| %>
									              <p><span id="date"><%=m[0...27]%></span>
																	<%=m[28...-1]%></p>
									              <% end %>
																<% else %>
																<h4> Nothing here yet! </h4>
															<% end %>


									            </div>
									</div>
                </div>

                <div class="half left">
                    <h4>Company Name</h4>
                    404-808 Duis lacinia dictum,<br />
                    Aliquam suscipit ipsum, 11660<br />
                    Diam a mollis tempor<br /><br />

                    <strong>Phone:</strong> 060-060-0660<br />
            		<strong>Email:</strong> <a href="mailto:info@company.com">info@company.com</a><br />

                    <div class="clear h20"></div>
                    <div class="img_nom img_border"><span></span>
                    <iframe width="350" height="150" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=new+york+central+park&amp;aq=&amp;sll=37.0625,-95.677068&amp;sspn=60.158465,135.263672&amp;vpsrc=6&amp;ie=UTF8&amp;hq=&amp;hnear=Central+Park,+New+York&amp;t=m&amp;ll=40.769606,-73.973372&amp;spn=0.014284,0.033023&amp;z=14&amp;output=embed"></iframe></div><small><a href="http://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=new+york+central+park&amp;aq=&amp;sll=37.0625,-95.677068&amp;sspn=60.158465,135.263672&amp;vpsrc=6&amp;ie=UTF8&amp;hq=&amp;hnear=Central+Park,+New+York&amp;t=m&amp;ll=40.769606,-73.973372&amp;spn=0.014284,0.033023&amp;z=14" style="color:#0000FF; text-align:left">View Larger Map</a></small>
                </div>
                <a href="#home" class="home_btn">home</a>
                <a href="#testimonial" class="page_nav_btn previous">Previous</a>
                <a href="#home" class="page_nav_btn next">Next</a>
            </div>
        </div>
    </div>
</div>


</div>

<% else %>
<div align="center" id="home" class="section">

	<ul id="templatemo_menu">
		<li><a href="#about" class="about"><span>Profile</span></a></li>
		<li><a href="#book" class="services"><span>Appointments</span></a></li>
		<li><a href="#medicines" class="portfolio"><span>Medicines</span></a></li>
		<li><a href="#testimonial" class="testimonial"><span>Testimonial</span></a></li>
		<li class="no_margin_right"><a href="#chat" class="contact"><span>Contact</span></a></li>
	</ul>

</div>



<div align="center"  style="width: 820px; height: 600px; background: rgba(76, 175, 80, 0.1); position:relative; top: -300px; left: 0px; ">


<div align="center" id="sign_in" style="position:relative; top: 60px;  left: 0px;">
	<div  style="position:relative; top: -260px;  left: 0px;">
	<h2>&nbsp;</h2>
	<form   action="/users/home" method="post" >
		<div class="imgcontainer" style="position:relative; top: -25px; left: 0px;">
				<img src="/img/welcome.png" alt="Avatar" class="avatar">
		</div>



			<label class="e-mail" for="email"><b>E-mail: &nbsp; &nbsp; &nbsp;</b></label>
			<input class="e-mail" type="email" placeholder="Enter E-mail.." name="email" required>
			<br />
			<br />
			<label class="password" for="password"><b>Password: &nbsp;</b></label>
			<input class="password" type="password" placeholder="Enter Password.." name="password" required>
			<br />
			<button type="submit" >Sign in</button>
			<br />
	<a href="javascript:void(0);" onclick="showSignUp(); return false;" >Sign up?</a>
	</form>

</div>
</div>

<div align="center" id="sign_up" style="position:relative; top: -240px;  left: 0px;">
	<div  style="position:relative; top: -100px;  left: 0px;">
	<h2>&nbsp;</h2>
	<form   action="/users" method="post" >
		<div class="imgcontainer" style="position:relative; top: 10px; left: 0px;">
				<img src="/img/welcome.png" alt="Avatar" class="avatar">
		</div>
<p> &nbsp; </p>
			<label class="e-mail" for="email"><b>E-mail: &nbsp; &nbsp; &nbsp;</b></label>
			<input class="e-mail" type="email" placeholder="Enter E-mail.." name="email" required>
			<br />
			<br />
			<label class="password" for="password"><b>Password: &nbsp;</b></label>
			<input class="password" type="password" placeholder="Enter Password.." name="password" required>
			<br />
			<button type="submit" >Sign up</button>
			<br />
	<a href="javascript:void(0);" onclick="showSignIn(); return false;" >Sign in?</a>
	</form>

</div>
</div>

</div>




</div>


<%end%>

<div id="templatemo_footer_wrapper">
	<div id="templatemo_footer">
    	<p>Copyright © 2020 PetVet | Designed & developed by AtlasGeek7
		<a class='nav-link' href='/logout' id='log-out-button'>	<button style="float: right; border-radius: 100%; background-color: transparent; width:40px; height: 40px; position: relative; top: -28px; left: 100px;" >
				<img src="/img/logout.png" width="40" height="40" title="Logout" alt="Add New Pet" style="border-radius: 100%; position: relative; top: -3px; left: -8px;">
			</button>
			</a>
			</p>
    </div>
</div>
<!-- templatemo 359 singular -->
<script type="text/JavaScript">
	var usrfrm = document.getElementById("usrfrm")
	var petfrm  = document.getElementById("petfrm")
	var nxtBtn = document.getElementById("nxtBtn")
	var addPetBtn = document.getElementById("addPetBtn")
	var mainDiv = document.getElementById("main")
	var addPetDiv = document.getElementById("addPet")
	var sndBtn = null
	var editBtn = null
	var fld = null
	var petInf = null
	function frmOn(id) {
		fld = document.getElementById("fld"+id)
		sndBtn = document.getElementById("sndBtn"+id)
		editBtn = document.getElementById("editBtn"+id)
		petInf = document.getElementById("petInf"+id)
		if (editBtn.innerText  == "Edit") {
			editBtn.innerText  = "Cancel"
			fld.disabled = false
			sndBtn.style.visibility = 'visible'

		}	else {
			editBtn.innerText  = "Edit"

			petInf.reset()
			fld.disabled = true
			sndBtn.style.visibility = 'hidden'
		}
	}

	function petfrmOn(idx) {

		for (let i=0; i<idx ; i++) {
			document.getElementById("petInf"+i).reset()
			document.getElementById("fld"+i).disabled = true
			document.getElementById("sndBtn"+i).style.visibility = 'hidden'
			document.getElementById("editBtn"+i).innerText  = "Edit"
		}
		mainDiv.style.visibility = 'hidden'
		addPetDiv.style.visibility = 'visible'
		//petInf.style.visibility = 'hidden'
		petfrm.style.visibility = 'visible'


		//petfrm.style.top = '-800px';
		//frm.style.top = '0px';
	}

	function petfrmOff(idx) {
		mainDiv.style.visibility = 'visible'
		addPetDiv.style.visibility = 'hidden'
		petfrm.style.visibility = 'hidden'
		//petInf.style.visibility = 'visible'
		//petfrm.style.top = '-800px';
		//frm.style.top = '0px';
	}

	function upfrmOn(id) {
		var ele = document.getElementById("fileUp"+id)
		if (ele.style.display == 'block') {
			ele.style.display = 'none'
		} else {
			ele.style.display = 'block'
		}
	}

  function toggleForms() {

  nxtBtn.addEventListener("click", function(){
    usrfrm.style.visibility = 'hidden'
    petfrm.style.visibility = 'visible'
  });
  prvBtn.addEventListener("click", function(){
    usrfrm.style.visibility = 'visible'
    petfrm.style.visibility = 'hidden'
  });
}
</script>
</body>
</html>
